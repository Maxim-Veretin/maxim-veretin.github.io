<?$indexlemm =  array();
//массив для  индекса
$index = array();
?>

<!--получение списка запросов от пользователя в виде массива с проверкой на не пустые значения-->
<?
if($_POST['send'])
{
   if($_POST['textarea'])
   {
       $send_textarea = strip_tags($_POST['textarea']);
   }
   else
   {
       $send_textarea = 'отправлено пустое поле...';
   }
}


//массив заданных запросов
$list = explode("\n", $_POST['textarea']);

//массив минус слов, генерация массива для удаления
$list_minus = explode("\n", $_POST['textarea3']);
$i = 0;
foreach ($list_minus as $list_minus_item) { 
    $list_minus_item = str_replace(array("\r", "\n"), '', $list_minus_item);
    if ($i === 0) {
        $mas_minus = $list_minus_item;
    }
    ++$i;
    $mas_minus = $mas_minus . "|" . $list_minus_item;
}
$mas_minus = "(" . $mas_minus .")";
echo $mas_minus;

//массив минус геомаркеров, генерация массива для удаления геомаркеров, с учетом плюс гео
$list_plus_geo = explode("\n", $_POST['textarea_city']);


$i = 0;



//создание индекса
foreach ($list as $list_item) {
    $lemma = explode(" ", $list_item);
        //echo "<div>";
            for ($j = 0; $j < count($lemma); $j++) {
                $lemma[$j] = strtolower(preg_replace('/\s+/', '', $lemma[$j])); //нижний регистр и лишние пробелы            
                $code_match = array('/;/', '/"/', '/-/', '/-/', '/"/', '/!/', '/@/', '/#/', '/%/', '/&/', '//', '/~/', '/`/', '/=/', '/_/', '/;/', "/'/", '/[+]/', '/:/', '/[(]/', '/[)]/', '/ø/', '/:/'); //список исключаемых символов
                $lemma[$j] = preg_replace($code_match, '',  $lemma[$j]); // удаление символов             
            }   
        sort($lemma);
        foreach ($lemma as $indexlemm_item) {
            if (strlen($indexlemm_item) > 3) { //сохранять только слова более 2 символов
                $indexlemm[$i] = $indexlemm[$i] . " " . $indexlemm_item;
            }
        }

        $row = array(); // создаем пустую строку для каждой строки массива
        $row[1] = $indexlemm[$i]; // массив слов 
        $row[0] = $i+1; // номер в индексе
        $row[2] = preg_replace($code_match, '',  $list_item); // очищенные запросы (целые)
        $i++;
        $index[$i] = $row;
    }

        //массив для работы с элементами индекса
        // функция для сортировки элементов индекса по алфавиту
        function compareByDouble($a, $b) {
            return strcmp($a['1'], $b['1']);
        }

        // Сортировка индекса
        usort($index, 'compareByDouble');

        $i = 0;
        //настроить проверку на наличие дублей и удаление
        foreach ($index as $index_item) {
                        //проверка на минус слова
                        if(preg_match($mas_minus, $index_item[2]) !== 1) { 
                            //echo $index_item[0] . " - ". $index_item[2]."<br>";
                        }   
                        else {
                            $delete[$i] = $index_item[0];
                            $i++;
                        }  
            echo $index_item[0] . "-". $index_item[1]."<br>";
        }
        foreach ($delete as $delete_item) {
            unset($index[$delete_item]);
        }



//удаление минус слов
if($_POST['deleteminus'])
{
   if($_POST['textarea3'])
   {
        //массив для работы с элементами индекса
        $i = 0;
        foreach ($index as $index_item) {
                        //проверка на минус слова
                        if(preg_match($mas_minus, $index_item[2]) !== 1) { 
                            //echo $index_item[0] . " - ". $index_item[2]."<br>";
                        }   
                        else {
                            $delete[$i] = $index_item[0];
                            $i++;
                        }  
            echo $index_item[0] . " - ". $index_item[1]."<br>";
        }
        foreach ($delete as $delete_item) {
            unset($index[$delete_item]);
        }
   }
   else
   {
       $send_textarea = 'не заданы минус слова';
   }
}


// удаление геомаркеров
if($_POST['deletecity'])
{
   if($_POST['textarea_city'])
   {
        //массив для работы с элементами индекса
        $i = 0;
        foreach ($index as $index_item) {
                        //проверка на минус слова
                        if(preg_match($city, $index_item[2]) !== 1) { 
                            //echo $index_item[0] . " - ". $index_item[2]."<br>";
                        }   
                        else {
                            $delete[$i] = $index_item[0];
                            $i++;
                        }  
            //echo $index_item[0] . " - ". $index_item[2]."<br>";
        }
        foreach ($delete as $delete_item) {
            unset($index[$delete_item]);
        }
   }
   else
   {
       $send_textarea = 'не заданы минус геомаркеры';
   }
}

?>


<?
$city = "абаза|абакан|абдулино|абинск|агидель|агрыз|адыгейск|азнакаево|азов|ак-довурак|аксай|алагир|алапаевск|алатырь|алдан|алейск|александров|александровск|александровск-сахалинский|алексеевка|алексин|алзамай|алушта|альметьевск|амурск|анадырь|анапа|ангарск|андреаполь|анжеро-судженск|анива|апатиты|апрелевка|апшеронск|арамиль|аргун|ардатов|ардон|арзамас|аркадак|армавир|армянск|арсеньев|арск|артём|артёмовск|артёмовский|архангельск|асбест|асино|астрахань|аткарск|ахтубинск|ачинск|аша|бабаево|бабушкин|бавлы|багратионовск|байкальск|баймак|бакал|баксан|балабаново|балаково|балахна|балашиха|балашов|балей|балтийск|барабинск|барнаул|барыш|батайск|бахчисарай|бежецк|белгород|белебей|белёв|белинский|белово|белогорск|белозерск|белокуриха|беломорск|белорецк|белореченск|белоусово|белоярский|бердск|березники|берёзовский|берёзовский|беслан|бийск|бикин|билибино|биробиджан|бирск|бирюсинск|бирюч|благовещенск|благовещенск|благодарный|бобров|богданович|богородицк|богородск|боготол|богучар|бодайбо|бокситогорск|болгар|бологое|болотное|болохово|болхов|большой камень|бор|борзя|борисоглебск|боровичи|боровск|бородино|братск|бронницы|брянск|бугульма|бугуруслан|будённовск|бузулук|буинск|буй|буйнакск|бутурлиновка|валдай|валуйки|велиж|великие луки|великий новгород|великий устюг|вельск|венёв|верещагино|верея|верхнеуральск|верхний тагил|верхний уфалей|верхняя пышма|верхняя салда|верхняя тура|верхотурье|верхоянск|весьегонск|ветлуга|видное|вилюйск|вилючинск|вихоревка|вичуга|владивосток|владикавказ|владимир|волгоград|волгодонск|волгореченск|волжск|волжский|вологда|володарск|волоколамск|волосово|волхов|волчанск|вольск|воркута|воронеж|ворсма|воскресенск|воткинск|всеволожск|вуктыл|выборг|выкса|высоковск|высоцк|вытегра|вышний волочёк|вяземский|вязники|вязьма|вятские поляны|гаврилов посад|гаврилов-ям|гагарин|гаджиево|гай|галич|гатчина|гвардейск|гдов|геленджик|георгиевск|глазов|голицыно|горбатов|горно-алтайск|горнозаводск|горняк|городец|городище|городовиковск|гороховец|горячий ключ|грайворон|гремячинск|грозный|грязи|грязовец|губаха|губкин|губкинский|гудермес|гуково|гулькевичи|гурьевск|гурьевск|гусев|гусиноозёрск|гусь-хрустальный|давлеканово|дагестанские огни|далматово|дальнегорск|дальнереченск|данилов|данков|дегтярск|дедовск|демидов|дербент|десногорск|джанкой|дзержинск|дзержинский|дивногорск|дигора|димитровград|дмитриев|дмитров|дмитровск|дно|добрянка|долгопрудный|долинск|домодедово|донецк|донской|дорогобуж|дрезна|дубна|дубовка|дудинка|духовщина|дюртюли|дятьково|евпатория|егорьевск|ейск|екатеринбург|елабуга|елец|елизово|ельня|еманжелинск|емва|енисейск|ермолино|ершов|ессентуки|ефремов|железноводск|железногорск|железногорск|железногорск-илимский|железнодорожный|жердевка|жигулёвск|жиздра|жирновск|жуков|жуковка|жуковский|завитинск|заводоуковск|заволжск|заволжье|задонск|заинск|закаменск|заозёрный|заозёрск|западная двина|заполярный|зарайск|заречный|заречный|заринск|звенигово|звенигород|зверево|зеленогорск|зеленогорск|зеленоградск|зеленодольск|зеленокумск|зерноград|зея|зима|златоуст|злынка|змеиногорск|знаменск|зубцов|зуевка|ивангород|иваново|ивантеевка|ивдель|игарка|ижевск|избербаш|изобильный|иланский|инза|инсар|инта|ипатово|ирбит|иркутск|исилькуль|искитим|истра|ишим|ишимбай|йошкар-ола|кадников|казань|калач|калач-на-дону|калачинск|калининград|калининск|калитва|калтан|калуга|калязин|камбарка|каменка|каменногорск|каменск-уральский|каменск-шахтинский|камень-на-оби|камешково|камызяк|камышин|камышлов|канаш|кандалакша|канск|карабаново|карабаш|карабулак|карасук|карачаевск|карачев|каргат|каргополь|карпинск|карталы|касимов|касли|каспийск|катав-ивановск|катайск|качканар|кашин|кашира|кедровый|кемерово|кемь|керчь|кизел|кизилюрт|кизляр|кимовск|кимры|кингисепп|кинель|кинешма|киреевск|киренск|киржач|кириллов|кириши|киров|киров|кировград|кирово-чепецк|кировск|кировск|кирс|кирсанов|киселёвск|кисловодск|климовск|клин|клинцы|княгинино|ковдор|ковров|ковылкино|когалым|кодинск|козельск|козловка|козьмодемьянск|кола|кологрив|коломна|колпашево|колпино|кольчугино|коммунар|комсомольск|комсомольск-на-амуре|конаково|кондопога|кондрово|константиновск|копейск|кораблино|кореновск|коркино|королёв|короча|корсаков|коряжма|костерёво|костомукша|кострома|котельники|котельниково|котельнич|котлас|котово|котовск|кохма|красавино|красноармейск|красноармейск|красновишерск|красногорск|краснодар|краснозаводск|краснознаменск|краснознаменск|краснокаменск|краснокамск|красноперекопск|краснослободск|краснослободск|краснотурьинск|красноуральск|красноуфимск|красноярск|кременки|кронштадт|кропоткин|крым|крымск|кстово|кубинка|кувандык|кувшиново|кудымкар|кузнецк|куйбышев|кулебаки|кумертау|кунгур|купино|курган|курганинск|курильск|курлово|куровское|курск|куртамыш|курчатов|куса|кушва|кызыл|кыштым|кяхта|лабинск|лабытнанги|лагань|ладушкин|лаишево|лакинск|лангепас|лахденпохья|лебедянь|лениногорск|ленинск|ленинск-кузнецкий|ленск|лермонтов|лесной|лесозаводск|лесосибирск|ливны|ликино-дулёво|липецк|липки|лиски|лихославль|лобня|лодейное поле|ломоносов|лосино-петровский|луга|луза|лукоянов|луховицы|лысково|лысьва|лыткарино|льгов|любань|люберцы|любим|людиново|лянтор|магадан|магас|магнитогорск|майкоп|майский|макаров|макарьев|макушино|малая вишера|малгобек|малмыж|малоархангельск|малоярославец|мамадыш|мамоново|мантурово|мариинск|мариинский посад|маркс|махачкала|мглин|мегион|медвежьегорск|медногорск|медынь|межгорье|междуреченск|мезень|меленки|мелеуз|менделеевск|мензелинск|мещовск|миасс|микунь|миллерово|минеральные воды|минусинск|миньяр|мирный|мирный|михайлов|михайловка|михайловск|михайловск|мичуринск|могоча|можайск|можга|моздок|мончегорск|морозовск|моршанск|мосальск|москва|муравленко|мураши|мурманск|муром|мценск|мыски|мытищи|мышкин|набережные челны|навашино|наволоки|надым|назарово|назрань|называевск|нальчик|нариманов|наро-фоминск|нарткала|нарьян-мар|находка|невель|невельск|невинномысск|невьянск|нелидово|неман|нерехта|нерчинск|нерюнгри|нестеров|нефтегорск|нефтекамск|нефтекумск|нефтеюганск|нея|нижневартовск|нижнекамск|нижнеудинск|нижние серги|нижний ломов|нижний новгород|нижний тагил|нижняя салда|нижняя тура|николаевск|николаевск-на-амуре|никольск|никольск|никольское|новая ладога|новая ляля|новоалександровск|новоалтайск|новоаннинский|нововоронеж|новодвинск|новозыбков|новокубанск|новокузнецк|новокуйбышевск|новомичуринск|новомосковск|новопавловск|новоржев|новороссийск|новосибирск|новосиль|новосокольники|новотроицк|новоузенск|новоульяновск|новоуральск|новохопёрск|новочебоксарск|новочеркасск|новошахтинск|новый оскол|новый уренгой|ногинск|нолинск|норильск|ноябрьск|нурлат|нытва|нюрба|нягань|нязепетровск|няндома|облучье|обнинск|обоянь|обь|одинцово|ожерелье|озёрск|озёрск|озёры|октябрьск|октябрьский|окуловка|олёкминск|оленегорск|олонец|омск|омутнинск|онега|опочка|орёл|оренбург|орехово-зуево|орлов|орск|оса|осинники|осташков|остров|островной|острогожск|отрадное|отрадный|оха|оханск|очёр|павлово|павловск|павловск|павловский посад|палласовка|партизанск|певек|пенза|первомайск|первоуральск|перевоз|пересвет|переславль-залесский|пермь|пестово|петергоф|петров вал|петровск|петровск-забайкальский|петрозаводск|петропавловск-камчатский|петухово|петушки|печора|печоры|пикалёво|пионерский|питкяранта|плавск|пласт|плёс|поворино|подольск|подпорожье|покачи|покров|покровск|полевской|полесск|полысаево|полярные зори|полярный|поронайск|порхов|похвистнево|почеп|починок|пошехонье|правдинск|приволжск|приморск|приморск|приморско-ахтарск|приозерск|прокопьевск|пролетарск|протвино|прохладный|псков|пугачёв|пудож|пустошка|пучеж|пушкин|пушкино|пущино|пыталово|пыть-ях|пятигорск|радужный|радужный|райчихинск|раменское|рассказово|ревда|реж|реутов|ржев|родники|рославль|россошь|ростов|ростов-на-дону|рошаль|ртищево|рубцовск|рудня|руза|рузаевка|рыбинск|рыбное|рыльск|ряжск|рязань|саки|салават|салаир|салехард|сальск|самара|санкт-петербург|саранск|сарапул|саратов|саров|сасово|сатка|сафоново|саяногорск|саянск|светлогорск|светлоград|светлый|светогорск|свирск|свободный|себеж|севастополь|северо-курильск|северобайкальск|северодвинск|североморск|североуральск|северск|севск|сегежа|сельцо|семёнов|семикаракорск|семилуки|сенгилей|серафимович|сергач|сергиев посад|сердобск|серов|серпухов|сертолово|сестрорецк|сибай|сим|симферополь|сковородино|скопин|славгород|славск|славянск-на-кубани|сланцы|слободской|слюдянка|смоленск|снежинск|снежногорск|собинка|советск|советск|советск|советская гавань|советский|сокол|солигалич|соликамск|солнечногорск|соль-илецк|сольвычегодск|сольцы|сорочинск|сорск|сортавала|сосенский|сосновка|сосновоборск|сосновый бор|сосногорск|сочи|спас-деменск|спас-клепики|спасск|спасск-дальний|спасск-рязанский|среднеколымск|среднеуральск|сретенск|ставрополь|старая купавна|старая русса|старица|стародуб|старый оскол|стерлитамак|стрежевой|строитель|струнино|ступино|суворов|судак|суджа|судогда|суздаль|суоярви|сураж|сургут|суровикино|сурск|сусуман|сухиничи|сухой лог|сызрань|сыктывкар|сысерть|сычёвка|сясьстрой|тавда|таганрог|тайга|тайшет|талдом|талица|тамбов|тара|тарко-сале|таруса|татарск|таштагол|тверь|теберда|тейково|темников|темрюк|терек|тетюши|тимашёвск|тихвин|тихорецк|тобольск|тогучин|тольятти|томари|томмот|томск|топки|торжок|торопец|тосно|тотьма|трёхгорный|троицк|троицк|трубчевск|туапсе|туймазы|тула|тулун|туран|туринск|тутаев|тында|тырныауз|тюкалинск|тюмень|уварово|углегорск|углич|удачный|удомля|ужур|узловая|улан-удэ|ульяновск|унеча|урай|урень|уржум|урус-мартан|урюпинск|усинск|усмань|усолье|усолье-сибирское|уссурийск|усть-джегута|усть-илимск|усть-катав|усть-кут|усть-лабинск|устюжна|уфа|ухта|учалы|уяр|фатеж|феодосия|фокино|фокино|фролово|фрязино|фурманов|хабаровск|хадыженск|ханты-мансийск|харабали|харовск|хасавюрт|хвалынск|хилок|химки|холм|холмск|холуница|хотьково|цивильск|цимлянск|чадан|чайковский|чапаевск|чаплыгин|чебаркуль|чебоксары|чегем|чекалин|челябинск|чердынь|черемхово|черепаново|череповец|черкесск|чёрмоз|черноголовка|черногорск|чернушка|черняховск|чехов|чистополь|чита|чкаловск|чудово|чулым|чусовой|чухлома|шагонар|шадринск|шали|шарыпово|шарья|шатура|шахтёрск|шахты|шахунья|шацк|шебекино|шелехов|шенкурск|шилка|шимановск|шиханы|шлиссельбург|шумерля|шумиха|шуя|щёкино|щёлкино|щёлково|щербинка|щигры|щучье|электрогорск|электросталь|электроугли|элиста|энгельс|эртиль|юбилейный|югорск|южа|южно-сахалинск|южно-сухокумск|южноуральск|юрга|юрьев-польский|юрьевец|юрюзань|юхнов|ядрин|якутск|ялта|ялуторовск|янаул|яранск|яровое|ярославль|ярцево|ясногорск|ясный|яхрома|спб|нск|академическая|алушта|ебург|чукотка|украина|винница|волынская|донецк|житомир|закарпатская|запорожье|ивано-франковск|киев|кировоград|луганск|луцк|львов|николаев|одесса|полтава|ровно|сумы|тернополь|ужгород|харьков|херсон|хмельницкий|черкассы|чернигов|черновцы|питер|новосиб|аннино|армянск|екб|чукотский|україна|вінниця|волинська|донецьк|закарпатська|запоріжжя|івано-франківськ|київ|кіровоград|луганськ|луцк|львів|Миколаїв|одеса|рівно|суми|тернопіль|ужгород|харків|хмельницький|черкаси|чернігів|чернівці|санкт|санктпитербург|балашиха|бахчисарай|свердловск|беляево|джанкой|санктпетербург|битцевский парк|евпатория|бутово|керчь|київський|києвський|києві|киевский|красноперекопск|щёлкино|саки|судак|феодосия|ялта|симферополь|севастополь|вао|видное|внуково|воробьевы горы|воскресенск|дмитров|дмитрова|долгопрудный|домодедово|дубна|железнодорожный|жуковский|звенигород|зеленоград|зуево|ивантеевка|калужская|каховская|клин|коломна|коньково|королев|красногорск|лесопарковая|лобне|люберцы|марьино|мкад|московский|мск|мытищи|новоясеневская|новые черемушки|ногинск|одинцово|орехово|парк культуры|подмосковье|подмосковье|подольск|подольске|посад|поселок московский|пражская|профсоюзная|пушкино|раменское|раменском|реутов|свао|севастопольская|сергиев|серпухов|солнечногорск|солнцево|строгино|теплый стан|троицк|университет|фоминск|химки|чертановская|чехов|шаболовская|щелково|электросталь|юго-западная|южная|ясенево";
?>


<form method="POST">
    <p>Список запросов (ввод)</p><?echo count($list)." запросов<br>";?>
    <textarea name="textarea"><?
        foreach ($list as $list_item) {
            echo $list_item;
        }
    ?></textarea>

    <p>Индекс</p><?echo count($index)." запросов<br>";?>
    <textarea name="textarea2"><?
        foreach ($index as $index_item) {
            echo $index_item[2];
        }
    ?></textarea>

    <p>Минус слова</p>
    <textarea name="textarea3"><?
        foreach ($list_minus as $list_minus_item) {
           echo $list_minus_item; 
        }
    ?></textarea>
    <p>Список запросов (ввод)</p>
    <textarea name="textarea_city" placeholder="укажите список геомаркеров, которые нужно оставить"></textarea>

    <input type="submit" name="send" value="Создать индекс запросов">
    <input type="submit" name="deleteminus" value="Минус слова">
    <input type="submit" name="deletecity" value="Минус геомаркеры">  
</form>

